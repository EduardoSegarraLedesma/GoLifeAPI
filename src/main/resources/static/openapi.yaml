openapi: 3.0.3

info:
  title: GoLife API
  version: "1.0"

tags:
  - name: Health
    description: Endpoints de comprobación de estado
  - name: Users
    description: Endpoints de gestión de usuarios
  - name: Goals
    description: Endpoints de gestión de metas
  - name: Records
    description: Endpoints de gestión de registros

servers:
  - url: http://localhost:8080
  - url: https://golife-462914.oa.r.appspot.com

security:
  - bearerAuth: []

paths:
  # Health ---------->
  /api/salud:
    get:
      tags:
        - Health
      summary: Estado de salud de la aplicación
      security: []
      responses:
        "200":
          description: Todos los servicios disponibles
          content:
            text/plain:
              schema:
                type: string
                example: OK
        "503":
          description: Algún servicio no está disponible
          content:
            text/plain:
              schema:
                type: string
                example: Algunos servicios no estan disponibles
        "500":
          description: Error interno al comprobar la salud
          content:
            text/plain:
              schema:
                type: string
                example: "Comprobacion de salud fallida: Error Interno"

  # Users ---------->
  /api/usuarios:
    post:
      tags:
        - Users
      summary: Crear un nuevo usuario
      description: Crea un usuario asociado al token del solicitante.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        "201":
          description: Usuario creado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "400":
          description: Datos de usuario inválidos (se devuelve el primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                NombreObligatorio:
                  summary: Falla NotBlank en nombre
                  value: "El nombre es obligatorio"
                NombreTamaño:
                  summary: Falla Size en nombre
                  value: "El nombre debe tener entre 2 y 50 caracteres"
                ApellidosTamaño:
                  summary: Falla Size en apellidos
                  value: "Los apellidos deben tener entre 0 y 50 caracteres"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "409":
          description: El usuario ya existe
          content:
            text/plain:
              schema:
                type: string
                example: "El usuario ya existe"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: No se ha podido crear al usuario
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al crear el usuario
    get:
      tags:
        - Users
      summary: Obtener datos del usuario actual
      description: Recupera el usuario asociado al token Bearer
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: No se ha encontrado al usuario
          content:
            text/plain:
              schema:
                type: string
                example: No se ha encontrado al usuario
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al leer el usuario
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al leer el usuario
    patch:
      tags:
       - Users
      summary: Actualizar datos del usuario actual
      description: Actualiza el usuario asociado al token Bearer
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchUserRequest'
      responses:
        "200":
          description: Usuario actualizado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "400":
          description: Datos de usuario inválidos (se devuelve el primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                NombreTamaño:
                  summary: Falla Size en nombre
                  value: "El nombre debe tener entre 2 y 50 caracteres"
                ApellidosTamaño:
                  summary: Falla Size en apellidos
                  value: "Los apellidos deben tener entre 0 y 50 caracteres"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: No se ha encontrado al usuario
          content:
            text/plain:
             schema:
               type: string
               example: No se ha encontrado al usuario
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al editar el usuario
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al editar el usuario
    delete:
      tags:
        - Users
      summary: Eliminar el usuario actual
      description: Elimina el usuario asociado al token Bearer
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: Usuario eliminado exitosamente
          content:
            text/plain:
              schema:
                type: string
                example: "Usuario eliminado exitosamente"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "404":
          description: No se ha encontrado al usuario
          content:
            text/plain:
              schema:
                type: string
                example: No se ha encontrado al usuario
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al eliminar el usuario
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al eliminar el usuario

  # Goals ---------->
  /api/metas/bool:
    post:
      tags:
        - Goals
      summary: Crear una nueva meta booleana
      description: Crea una meta de tipo booleano asociada al usuario del token Bearer.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBoolGoalRequest'
      responses:
        "201":
          description: Meta booleana creada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "400":
          description: Datos de la meta no válidos (primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                MissingName:
                  summary: Nombre ausente
                  value: "El nombre de la meta es obligatorio"
                NameTooLong:
                  summary: Nombre demasiado largo
                  value: "El nombre no puede superar los 50 caracteres"
                DescriptionTooLong:
                  summary: Descripción demasiado larga
                  value: "La descripción no puede superar los 300 caracteres"
                MissingDate:
                  summary: Fecha ausente
                  value: "La fecha de inicio es obligatoria"
                DurationNegativeOrZero:
                  summary: Duración negativa
                  value: "La duración no puede ser negativa ni cero"
                DurationTooLarge:
                  summary: Duración excesiva
                  value: "La duración es demasiado grande, maximo 10000"
                MissingDurationUnit:
                  summary: Unidad de duración ausente
                  value: "La unidad de duración es obligatoria"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al crear la meta
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al crear la meta
  /api/metas/num:
    post:
      tags:
        - Goals
      summary: Crear una nueva meta numérica
      description: Crea una meta de tipo numérico asociada al usuario del token Bearer.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNumGoalRequest'
      responses:
        "201":
          description: Meta numérica creada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "400":
          description: Datos de la meta no válidos (primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                MissingName:
                  summary: Nombre ausente
                  value: "El nombre de la meta es obligatorio"
                NameTooLong:
                  summary: Nombre demasiado largo
                  value: "El nombre no puede superar los 50 caracteres"
                DescriptionTooLong:
                  summary: Descripción demasiado larga
                  value: "La descripción no puede superar los 300 caracteres"
                MissingDate:
                  summary: Fecha ausente
                  value: "La fecha de inicio es obligatoria"
                DurationNegativeOrZero:
                  summary: Duración negativa
                  value: "La duración no puede ser negativa ni cero"
                DurationTooLarge:
                  summary: Duración excesiva
                  value: "La duración es demasiado grande, maximo 10000"
                MissingDurationUnit:
                  summary: Unidad de duración ausente
                  value: "La unidad de duración es obligatoria"
                MissingValorObjetivo:
                  summary: Valor objetivo ausente
                  value: "El valor objetivo es obligatorio"
                ValorObjetivoNotPositive:
                  summary: Valor objetivo no positivo
                  value: "El valor objetivo debe ser un número positivo"
                ValorObjetivoIncorrectFormat:
                  summary: Valor objetivo tiene un formato incorrecto
                  value: "Formato inválido: máximo 13 cifras enteras y 2 decimales"
                MissingUnidad:
                  summary: Unidad ausente
                  value: "La unidad es obligatoria"
                UnidadTooLong:
                  summary: Unidad demasiado larga
                  value: "La unidad no debe tener más de 20 caracteres"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al crear la meta
          content:
            text/plain:
              schema:
                type: string
                example: Error interno al crear la meta
  /api/metas/{mid}:
    get:
      tags:
        - Goals
      summary: Obtener una meta por su identificador
      description: Recupera la meta (booleana o numérica) asociada al usuario del token Bearer.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
            example: "60f5a4b2e1d3f5c1a4e9d8b7"
      responses:
        "200":
          description: Meta encontrada
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ResponseBoolGoal'
                  - $ref: '#/components/schemas/ResponseNumGoal'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: No se ha encontrado la meta
          content:
            text/plain:
              schema:
                type: string
                example: "Meta no encontrada"
        "429":
          $ref: '#/components/responses/TooManyRequests'
    patch:
      tags:
        - Goals
      summary: Actualizar parcialmente una meta
      description: Actualiza una meta; el parámetro `tipo` determina el DTO de request y de response.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
        - name: tipo
          in: query
          description: Tipo de la meta a actualizar
          required: true
          schema:
            type: string
            enum: [ Bool, Num ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/PatchBoolGoalRequest'
                - $ref: '#/components/schemas/PatchNumGoalRequest'
      responses:
        "200":
          description: Meta actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "400":
          description: Error en la petición (primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                MalformedJSON:
                  summary: JSON malformado o inválido
                  value: "Cuerpo de la petición malformado"
                UnsupportedType:
                  summary: Tipo de meta no soportado (parametro tipo no es ni Num ni Bool)
                  value: "Tipo de meta no soportado"
                IncorrectType:
                  summary: Parametro tipo es Num cuando meta es Bool o viceversa
                  value: "Tipo incorrecto para la meta"
                NameTooLong:
                  summary: Nombre demasiado largo
                  value: "El nombre no puede superar los 50 caracteres"
                DescriptionTooLong:
                  summary: Descripción demasiado larga
                  value: "La descripción no puede superar los 300 caracteres"
                DurationNegativeOrZero:
                  summary: Duración negativa
                  value: "La duración no puede ser negativa ni cero"
                DurationTooLarge:
                  summary: Duración excesiva
                  value: "La duración es demasiado grande, maximo 10000"
                ValorObjetivoNotPositive:
                  summary: Valor objetivo no positivo
                  value: "El valor objetivo debe ser un número positivo"
                ValorObjetivoIncorrectFormat:
                  summary: Valor objetivo tiene un formato incorrecto
                  value: "Formato inválido: máximo 13 cifras enteras y 2 decimales"
                UnidadTooLong:
                  summary: Unidad demasiado larga
                  value: "La unidad no debe tener más de 20 caracteres"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: No se ha encontrado la meta
          content:
            text/plain:
              schema:
                type: string
                example: "Meta no encontrada"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al actualizar la meta
          content:
            text/plain:
              schema:
                type: string
              examples:
                UpdateFailed:
                  summary: Persistencia fallida
                  value: "Error interno al editar la meta"
    delete:
      tags:
        - Goals
      summary: Eliminar una meta
      description: Elimina la meta (booleana o numérica) asociada al usuario del token Bearer.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
            example: "60f5a4b2e1d3f5c1a4e9d8b7"
      responses:
        "200":
          description: Estadísticas actualizadas tras eliminar la meta correctamente
          content:
             application/json:
              schema:
                $ref: '#/components/schemas/ResponseUserStats'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: Meta no encontrada
          content:
            text/plain:
              schema:
                type: string
                example: "Meta no encontrada"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al eliminar la meta
          content:
            text/plain:
              schema:
                type: string
                example: "Error interno al eliminar la meta"

  /api/metas/{mid}/finalizar:
    post:
      tags:
        - Goals
      summary: Marcar una meta como finalizada
      description: Establece `finalizado = true` en la meta indicada, sea booleana o numérica.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
            example: "60f5a4b2e1d3f5c1a4e9d8b7"
      responses:
        "200":
          description: Meta actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResponseUser'
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: No se ha encontrado la meta
          content:
            text/plain:
              schema:
                type: string
                example: "Meta no encontrada"
        "409":
          description: La meta ya esta finalizada
          content:
            text/plain:
              schema:
                type: string
                example: "La meta ya esta finalizada"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al actualizar la meta
          content:
            text/plain:
              schema:
                type: string
              examples:
                UpdateFailed:
                  summary: Persistencia fallida
                  value: "Error interno al editar la meta"

  # Records -------->
  /api/metas/{mid}/registros:
    post:
      tags:
        - Records
      summary: Crear un registro para una meta
      description: Crea un registro (booleano o numérico) asociado a la meta indicada y devuelve la meta completa actualizada.
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
            example: "60f5a4b2e1d3f5c1a4e9d8b7"
        - name: tipo
          in: query
          description: Tipo del registro a crear (Num o Bool)
          required: true
          schema:
            type: string
            enum: [ Bool, Num ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/CreateBoolRecordRequest'
                - $ref: '#/components/schemas/CreateNumRecordRequest'
      responses:
        "200":
          description: Meta completa con el nuevo registro
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ResponseBoolGoal'
                  - $ref: '#/components/schemas/ResponseNumGoal'
        "400":
          description: Error en la petición (primer error de validación)
          content:
            text/plain:
              schema:
                type: string
              examples:
                MalformedJSON:
                  summary: JSON malformado o inválido
                  value: "Cuerpo de la petición malformado"
                UnsupportedType:
                  summary: Tipo de meta no soportado (parametro tipo no es ni Num ni Bool)
                  value: "Tipo de meta no soportado"
                IncorrectType:
                  summary: Parametro tipo es Num cuando meta es Bool o viceversa
                  value: "Tipo de registro incorrecto para la meta"
                DateBeforeStart:
                  summary: Fecha anterior a la inicial
                  value: "La fecha del registro no puede ser anterior a la fecha inicial de la meta"
                MissingDate:
                  summary: Fecha vacía
                  value: "La fecha no puede estar vacia"
                MissingBoolValue:
                  summary: Valor booleano ausente
                  value: "El check no puede estar vacio"
                MissingNumValue:
                  summary: Valor numérico ausente
                  value: "El valor del registro no puede ser nulo"
                NumValueNegative:
                  summary: Valor numérico negativo
                  value: "El valor del registro debe ser cero o positivo"
                NumValueFormat:
                  summary: Formato numérico inválido
                  value: "Formato inválido: máximo 13 cifras enteras y 2 decimales"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: Meta no encontrada
          content:
            text/plain:
              schema:
                type: string
                example: "Meta no encontrada"
        "409":
          description: Ya existe un registro para la fecha indicada
          content:
            text/plain:
              schema:
                type: string
                example: "Ya existe un registro para la fecha: 2025-06-28"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: No se ha podido crear el registro
          content:
            text/plain:
              schema:
                type: string
              examples:
                CreateFailed:
                  summary: Persistencia fallida
                  value: "No se ha podido crear el registro"
                InternalError:
                  summary: Excepción no controlada
                  value: "Error interno"

  /api/metas/{mid}/registros/{fecha}:
    delete:
      tags:
        - Records
      summary: Eliminar un registro de una meta
      description: Elimina el registro de la fecha indicada de la meta (booleano o numérico).
      security:
        - bearerAuth: [ ]
      parameters:
        - name: mid
          in: path
          description: Identificador de la meta (ObjectId MongoDB)
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
            example: "60f5a4b2e1d3f5c1a4e9d8b7"
        - name: fecha
          in: path
          description: Fecha del registro a eliminar (ISO 8601)
          required: true
          schema:
            type: string
            format: date
            example: "2025-06-28"
      responses:
        "200":
          description: Registro eliminado exitosamente
          content:
            text/plain:
              schema:
                type: string
                example: "Registro eliminado exitosamente"
        "401":
          $ref: '#/components/responses/Unauthorized'
        "403":
          description: No autorizado para acceder a esta meta
          content:
            text/plain:
              schema:
                type: string
                example: "No autorizado para acceder a esta meta"
        "404":
          description: Meta o Registro no encontrados
          content:
            text/plain:
              schema:
                type: string
              examples:
                RecordNotFound:
                  summary: Fecha sin registro
                  value: "Registro no encontrado"
                GoalNotFound:
                  summary: Meta inexistente
                  value: "Meta no encontrada"
        "429":
          $ref: '#/components/responses/TooManyRequests'
        "500":
          description: Error interno al eliminar el registro
          content:
            text/plain:
              schema:
                type: string
              examples:
                DeleteFailed:
                  summary: Persistencia fallida
                  value: "No se ha podido eliminar el registro"

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # — Usuarios —
    CreateUserRequest:
      type: object
      description: DTO para crear un usuario
      required:
        - nombre
        - apellidos
      properties:
        nombre:
          type: string
          description: Nombre del usuario
          minLength: 2
          maxLength: 50
          example: "Ana"
        apellidos:
          type: string
          description: Apellidos del usuario
          minLength: 0
          maxLength: 50
          example: "García"

    PatchUserRequest:
      type: object
      description: DTO para actualizar parcialmente un usuario
      minProperties: 1
      properties:
        nombre:
          type: string
          description: Nuevo nombre del usuario
          minLength: 2
          maxLength: 50
          example: "Luis"
        apellidos:
          type: string
          description: Nuevo/s apellido/s del usuario
          minLength: 0
          maxLength: 50
          example: "Fernández Lopez"

    ResponseUser:
      type: object
      description: DTO de respuesta para devolver un usuario
      required:
        - nombre
        - apellidos
        - metas
        - estadisticas
      properties:
        nombre:
          type: string
          example: "Ana"
        apellidos:
          type: string
          example: "García"
        metas:
          type: array
          items:
            oneOf:
              -  $ref: '#/components/schemas/ResponsePartialGoal'
              -  $ref: '#/components/schemas/ResponsePartialNumGoal'
            discriminator:
              propertyName: tipo
              mapping:
                Bool: '#/components/schemas/ResponsePartialGoal'
                Num: '#/components/schemas/ResponsePartialNumGoal'
        estadisticas:
          $ref: '#/components/schemas/ResponseUserStats'

    ResponseUserStats:
      type: object
      description: DTO de respuesta para devolver estadísticas/mediciones de un usuario
      required:
        - totalMetas
        - totalMetasFinalizadas
        - porcentajeFinalizadas
      properties:
        totalMetas:
          type: integer
          description: Número total de metas del usuario
          example: 5
        totalMetasFinalizadas:
          type: integer
          description: Número de metas finalizadas del usuario
          example: 2
        porcentajeFinalizadas:
          type: number
          description: Porcentaje de metas finalizadas del usuario
          example: 40.00

    # — Metas —
    CreateBoolGoalRequest:
      type: object
      description: DTO para crear una meta booleana
      required:
        - nombre
        - descripcion
        - fecha
        - duracionValor
        - duracionUnidad
      properties:
        nombre:
          type: string
          description: Nombre de la meta
          minLength: 1
          maxLength: 50
          example: "Beber 2 litros de agua"
        descripcion:
          type: string
          description: Descripción de la meta
          maxLength: 300
          example: "Recordar beber suficiente agua diariamente"
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta (ISO 8601)
          example: "2025-06-19"
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          minimum: 1
          maximum: 10000
          example: 30
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [Dias, Semanas, Meses, Años, Indefinido]
          example: "Dias"

    CreateNumGoalRequest:
      type: object
      description: DTO para crear una meta numérica
      required:
        - nombre
        - descripcion
        - fecha
        - duracionValor
        - duracionUnidad
        - valorObjetivo
        - unidad
      properties:
        nombre:
          type: string
          description: Nombre de la meta
          minLength: 1
          maxLength: 50
          example: "Beber agua"
        descripcion:
          type: string
          description: Descripción de la meta
          maxLength: 300
          example: "Beber al menos 2 litros de agua al día"
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta(ISO 8601)
          example: "2025-06-19"
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          minimum: 1
          maximum: 10000
          example: 7
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [Dias, Semanas, Meses, Años, Indefinido]
          example: "Dias"
        valorObjetivo:
          type: number
          format: double
          description: Valor objetivo numérico (positivo), hasta 13 dígitos enteros y 2 decimales
          minimum: 0.01
          maximum: 9999999999999.99
          multipleOf: 0.01
          example: 2.0
        unidad:
          type: string
          description: Unidad de medida para el valor objetivo
          minLength: 1
          maxLength: 20
          example: "litros"

    PatchBoolGoalRequest:
      type: object
      description: DTO para actualizar parcialmente una meta booleana
      minProperties: 1
      properties:
        nombre:
          type: string
          description: Nuevo nombre de la meta
          maxLength: 50
          example: "Nuevo nombre"
        descripcion:
          type: string
          description: Nueva descripción de la meta
          maxLength: 300
          example: "Descripción actualizada"
        duracionValor:
          type: integer
          description: Nueva cantidad de unidades de duración
          minimum: 1
          maximum: 10000
          example: 15
        duracionUnidad:
          type: string
          description: Nueva unidad de duración
          enum: [ Dias, Semanas, Meses, Años, Indefinido ]
          example: "Semanas"

    PatchNumGoalRequest:
      type: object
      description: DTO para actualizar parcialmente una meta numeral
      minProperties: 1
      properties:
        nombre:
          type: string
          description: Nuevo nombre de la meta
          maxLength: 50
          example: "Nuevo nombre"
        descripcion:
          type: string
          description: Nueva descripción de la meta
          maxLength: 300
          example: "Descripción actualizada"
        duracionValor:
          type: integer
          description: Nueva cantidad de unidades de duración
          minimum: 1
          maximum: 10000
          example: 15
        duracionUnidad:
          type: string
          description: Nueva unidad de duración
          enum: [Dias, Semanas, Meses, Años, Indefinido]
          example: "Semanas"
        valorObjetivo:
          type: number
          format: double
          description: nuevo Vvlor objetivo numérico (positivo), hasta 13 dígitos enteros y 2 decimales
          minimum: 0.01
          maximum: 9999999999999.99
          multipleOf: 0.01
          example: 123.15
        unidad:
          type: string
          description: Nueva unidad para el valor objetivo
          minLength: 1
          maxLength: 20
          example: "kg"

    ResponseBoolGoal:
      type: object
      description: |
        DTO de respuesta para devolver una meta booleana
        **Reglas especiales:**
        - Si `duracionUnidad` es `Indefinido`, entonces:
          - `duracionValor` será **-1**.
          - `fechaFin` será una cadena vacía (`""`).
      required:
        - _id
        - nombre
        - descripcion
        - tipo
        - fecha
        - finalizado
        - duracionValor
        - duracionUnidad
        - estadisticas
        - registros
      properties:
        _id:
          type: string
          example: "60f5a4b2e1d3f5c1a4e9d8b7"
          description: Identificador de la meta
        nombre:
          type: string
          description: Nombre de la meta
          example: "Caminar cada día"
        descripcion:
            type: string
            description: Descripcion de la meta
            example: "Me gustaria moverme más"
        tipo:
          type: string
          description: Tipo de la meta (Bool)
          enum: [Bool]
          example: "Bool"
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta (ISO 8601)
          example: "2025-06-27"
        finalizado:
          type: boolean
          description: Si la meta está finalizada
          example: false
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          example: 30
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [ Dias, Semanas, Meses, Años, Indefinido ]
          example: "Meses"
        estadisticas:
          $ref: '#/components/schemas/ResponseGoalStats'
        registros:
          type: array
          description: Lista de registros booleanos de la meta
          items:
            $ref: '#/components/schemas/ResponseBoolRecord'

    ResponseNumGoal:
      type: object
      description: |
        DTO de respuesta para devolver una meta numerica
        **Reglas especiales:**
        - Si `duracionUnidad` es `Indefinido`, entonces:
          - `duracionValor` será **-1**.
          - `fechaFin` será una cadena vacía (`""`).
      required:
        - _id
        - nombre
        - descripcion
        - tipo
        - fecha
        - finalizado
        - duracionValor
        - duracionUnidad
        - estadisticas
        - valorObjetivo
        - unidad
        - registros
      properties:
        _id:
          type: string
          example: "70a6b5c3d4e5f6a7b8c9d0e1"
          description: Identificador de la meta
        nombre:
          type: string
          description: Nombre de la meta
          example: "Perder peso"
        descripcion:
          type: string
          description: Descripción de la meta
          example: "Meta de reducir 5 kg en 3 meses"
        tipo:
          type: string
          description: Tipo de la meta (Num)
          enum: [ Num ]
          example: "Num"
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta (ISO 8601)
          example: "2025-06-27"
        finalizado:
          type: boolean
          description: Si la meta está finalizada
          example: false
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          example: 3
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [ Dias, Semanas, Meses, Años, Indefinido ]
          example: "Meses"
        estadisticas:
          $ref: '#/components/schemas/ResponseGoalStats'
        valorObjetivo:
          type: number
          description: Valor objetivo numérico (positivo), hasta 13 dígitos enteros y 2 decimales
          example: 5.0
        unidad:
          type: string
          description: Unidad de medida para el valor objetivo
          example: "kg"
        registros:
          type: array
          description: Lista de registros numéricos de la meta
          items:
            $ref: '#/components/schemas/ResponseNumRecord'

    ResponseGoalStats:
      type: object
      description: DTO de respuesta para devolver estadísticas/mediciones de una meta
      required:
        - tienePrimerRegistro
        - acabaDeCrearsePrimerRegistro
        - fechaFin
      properties:
        tienePrimerRegistro:
          type: boolean
          description: Indica si se ha habido al menos un  objetivo una vez, una vez true no vuelve a false
        acabaDeCrearsePrimerRegistro:
          type: boolean
          description: Flag que indica si se acaba de crear un registro por primera vez
        fechaFin:
          type: string
          format: date
          description: Fecha en la que se termina el perido de tiempo dado para la meta

    ResponsePartialGoal:
      type: object
      description: DTO de respuesta para devolver datos básicos de una meta Booleana
      required:
        - _id
        - nombre
        - tipo
        - fecha
        - finalizado
        - duracionValor
        - duracionUnidad
      properties:
        _id:
          type: string
          example: "60f5a4b2e1d3f5c1a4e9d8b7"
          description: Identificador de la meta
        nombre:
          type: string
          description: Nombre de la meta
        tipo:
          type: string
          description: Tipo de la meta (Bool o Num)
          enum: [ Bool, Num ]
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta (ISO 8601)
        finalizado:
          type: boolean
          description: Si la meta está finalizada
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          example: 3
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [ Dias, Semanas, Meses, Años, Indefinido ]

    ResponsePartialNumGoal:
      type: object
      description: DTO de respuesta para devolver datos básicos de una meta Numeral
      required:
        - _id
        - nombre
        - tipo
        - fecha
        - finalizado
        - duracionValor
        - duracionUnidad
        - valorObjetivo
        - unidad
      properties:
        _id:
          type: string
          example: "60f5a4b2e1d3f5c1a4e9d8b7"
          description: Identificador de la meta
        nombre:
          type: string
          description: Nombre de la meta
        tipo:
          type: string
          description: Tipo de la meta (Bool o Num)
          enum: [ Bool, Num ]
        fecha:
          type: string
          format: date
          description: Fecha de inicio de la meta (ISO 8601)
        finalizado:
          type: boolean
          description: Si la meta está finalizada
        duracionValor:
          type: integer
          description: Cantidad de unidades de duración
          example: 3
        duracionUnidad:
          type: string
          description: Unidad de duración
          enum: [ Dias, Semanas, Meses, Años, Indefinido ]
        valorObjetivo:
            type: number
            description: Valor objetivo numérico (positivo), hasta 13 dígitos enteros y 2 decimales
            example: 5.0
        unidad:
            type: string
            description: Unidad de medida para el valor objetivo
            example: "kg"

    # — Registros —
    CreateBoolRecordRequest:
      type: object
      description: DTO para crear un registro booleano
      required:
        - fecha
        - valorBool
      properties:
        fecha:
          type: string
          format: date
          description: Fecha del registro (ISO 8601)
          example: "2025-06-19"
        valorBool:
          type: boolean
          description: Check de verdadero/falso
          example: true

    CreateNumRecordRequest:
      type: object
      description: DTO para crear un registro numérico
      required:
        - fecha
        - valorNum
      properties:
        fecha:
          type: string
          format: date
          description: Fecha del registro (ISO 8601)
          example: "2025-06-19"
        valorNum:
          type: number
          format: double
          description: Valor numérico del registro (positivo), hasta 13 dígitos enteros y 2 decimales
          minimum: 0.01
          maximum: 9999999999999.99
          multipleOf: 0.01
          example: 2.0

    ResponseBoolRecord:
      type: object
      description: DTO de respuesta para devolver un registro booleano
      required:
        - fecha
        - valorBool
      properties:
        fecha:
          type: string
          format: date
          description: Fecha del registro (ISO 8601)
          example: "2025-06-19"
        valorBool:
          type: boolean
          description: Check de verdadero/falso
          example: false

    ResponseNumRecord:
      type: object
      description: DTO de respuesta para devolver un registro numérico
      required:
        - fecha
        - valorNum
      properties:
        fecha:
          type: string
          format: date
          description: Fecha del registro (ISO 8601)
          example: "2025-06-19"
        valorNum:
          type: number
          format: double
          description: Valor numérico del registro (positivo), hasta 13 dígitos enteros y 2 decimales
          minimum: 0.01
          maximum: 9999999999999.99
          multipleOf: 0.01
          example: 2.0

  responses:

    Unauthorized:
      description: Unauthorized – falta el encabezado Authorization o token inválido
      content:
        text/plain:
          schema:
            type: string
          examples:
            InvalidToken:
              summary: Token inválido
              value: "Token inválido"
            MissingHeader:
              summary: Falta el encabezado Authorization
              value: "Falta el encabezado Authorization"

    TooManyRequests:
      description: Too Many Requests – rate limit excedido
      content:
        text/plain:
          schema:
            type: string
            example: "Demasiadas peticiones. Espera un momento por favor"